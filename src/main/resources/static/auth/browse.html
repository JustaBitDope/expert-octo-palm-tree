<!DOCTYPE HTML>
<html>

<head lang="en-US">
	<title>Browse</title>
</head>

<body>

	<h1 style= "text-align: center">Come do Some Browse brah</h1>
	<p style= "text-align: center">Waddup yo. We got some good shit for you to browse right here.</p>
	
	<p id="checker" ></p>
	
	<p id="output" ></p>
	
	<div>
		<table id="allAuctions"></table>
	</div>
</body>

<footer>
   	<!-- import jQuery -->
   	<script src="../js/jquery-1.11.2.min.js"></script> 
	 
	<!-- $(document).ready -->
	<script>
		// Runs when the page has loaded
		$(document).ready(function() {
			$.ajax({
				type: "GET",
				datatype: "json",
				url: "/auth/auction/all",
				success: function(all_auctions) {
					console.log("win! wooo!");
					console.log(all_auctions);
					displayAllAuctions(all_auctions);
				},
				error: function() {
					console.log("Error yo");
					$("#checker").text("error. balls.");
					$("#output").text("Summat broke");
				}
			});
		});
	</script>
	<!-- -->

	<!-- displayAllAuctions(auctions) -->
	<script>
		// Displays all auctions on the page
		function displayAllAuctions(auctions){
			console.log("SUCC!");
			console.log(auctions);
			$("#checker").text("Success! Apparently...");
			$("#output").text(auctions);

			for(var i=0; i!=auctions.length; i++) {
				var auction = auctions[i];
				displayAuction(auction);
				//displayAuction(auction);
			}
		}
	</script>
	
	<!-- displayAuction(auction) -->
   	<script>
   		function displayAuction(auction){
			console.log(auction);
			var item = auction.item;	
			
			//The Table we will being appending to
			var tbl = document.getElementById("allAuctions");
			
			//The Data to put into the table
			var name = document.createTextNode(item.name);
			var desc = document.createTextNode(item.description);
			var cat  = document.createTextNode(item.category.name);
			
			var start = new Date(auction.startDate.epochSecond * 1000);
			var end = new Date(auction.endDate.epochSecond * 1000);  			

			var startDay = start.getDate();
			var endDay = end.getDate();
			var startMonth = start.getMonth() + 1;		//0 = Jan
			var endMonth = end.getMonth() + 1;			//0 = Jan
			console.log(startDay > 10);
			if(10 > startDay)startDay = "0"+startDay;
			if(10 > endDay)endDay = "0"+endDay;
			if(10 > startMonth)startMonth = "0"+startMonth;
			if(10 > endMonth)endMonth = "0"+endMonth;

			
			var startFormat = document.createTextNode(startDay + '/' + startMonth + '/' + start.getFullYear());
			var endFormat = document.createTextNode(endDay + '/' + endMonth + '/' + end.getFullYear());
			
			//Add Title data to table
			var row = tbl.insertRow(-1);					
			var col_1 = row.insertCell(-1);
			var col_2 = row.insertCell(-1);
			col_1.appendChild(document.createTextNode("Title: "));
			col_2.appendChild(name);

			//Add Desc data
			row = tbl.insertRow(-1);					
			col_1 = row.insertCell(-1);
			col_2 = row.insertCell(-1);
			col_1.appendChild(document.createTextNode("Descritpion: "));
			col_2.appendChild(desc);

			//Add Cat data
			row = tbl.insertRow(-1);					
			col_1 = row.insertCell(-1);
			col_2 = row.insertCell(-1);
			col_1.appendChild(document.createTextNode("Category: "));
			col_2.appendChild(cat);
			
			//Add Start Date
			row = tbl.insertRow(-1);					
			col_1 = row.insertCell(-1);
			col_2 = row.insertCell(-1);
			col_1.appendChild(document.createTextNode("Start: "));
			col_2.appendChild(startFormat);

			//Add End Date
			row = tbl.insertRow(-1);					
			col_1 = row.insertCell(-1);
			col_2 = row.insertCell(-1);
			col_1.appendChild(document.createTextNode("End: "));
			col_2.appendChild(endFormat);

			//Add Button to view specific Auction 
			var viewAuctBtn = document.createElement('button');
			//Button is assigned id of relevant auction
			viewAuctBtn.id = auction.id;
			viewAuctBtn.innerHTML = "View Auction Page";
			viewAuctBtn.onclick = function(){viewAuction(this);}
			
			row = tbl.insertRow(-1);					
			col_1 = row.insertCell(-1);
			col_1.colspan = 2;
			col_1.appendChild(viewAuctBtn);				

   		}
   	</script>
	

	<!-- viewAuction(btnClicked) -->
	<script>
    		function viewAuction(btnClicked){
    			var auctionID = btnClicked.id;
    			console.log("Selected Auction: "+auctionID);
    			window.location.href = "/viewAuction?id="+auctionID;
    		}
  </script>
  <!-- -->
</footer>

</html>